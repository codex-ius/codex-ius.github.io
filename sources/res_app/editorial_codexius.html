<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIBYL_EDITORIAL_ver_01.2</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --primary: #00e5ff; --bg-ui: #000b14;
            --paper-bg: #ffffff; --paper-text: #1a1a1a;
            --accent: #00e5ff;
            --width-page: 210mm; --height-page: 297mm;
        }

        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg-ui); color: var(--primary); font-family: 'JetBrains Mono', monospace; display: flex; flex-direction: column; overflow: hidden; }
        
        #metadata-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; padding: 5px; background: rgba(0, 229, 255, 0.1); border-bottom: 1px solid var(--primary); height: 45px; }
        #metadata-bar input { background: #000; border: 1px solid var(--primary); color: var(--primary); padding: 5px; font-size: 10px; outline: none;}

        #editor-container { height: 40vh; display: flex; flex-direction: column; border-bottom: 2px solid var(--primary); }
        textarea { flex-grow: 1; background: #000; color: #fff; border: none; padding: 15px; resize: none; outline: none; font-size: 14px; }

        .toolbar { display: flex; background: var(--bg-ui); border-top: 1px solid var(--primary); }
        .toolbar select, .toolbar button, .toolbar label { background: transparent; color: var(--primary); border-right: 1px solid var(--primary); padding: 8px; cursor: pointer; flex: 1; font-size: 10px; text-transform: uppercase; }

        #preview-viewport { flex-grow: 1; overflow-y: auto; background: #050505; padding: 30px 10px; display: flex; flex-direction: column; align-items: center; }
        #btn-exit-foco { position: fixed; top: 10px; right: 10px; z-index: 1000; background: var(--primary); color: #000; border: none; padding: 10px; font-weight: bold; display: none; }

        /* --- ESTILOS DE PÁGINA --- */
        .page { background: var(--paper-bg); color: var(--paper-text); padding: 25mm 20mm; margin-bottom: 30px; width: var(--width-page); min-height: var(--height-page); position: relative; box-sizing: border-box; overflow: hidden; }
        
        .page-header { position: absolute; top: 10mm; left: 10mm; right: 10mm; display: flex; justify-content: space-between; font-size: 8pt; color: var(--accent); border-bottom: 1.5pt solid var(--accent); }
        .page-footer { position: absolute; bottom: 10mm; left: 10mm; right: 10mm; display: flex; justify-content: space-between; font-size: 8pt; color: var(--accent); border-top: 1.5pt solid var(--accent); }

        /* --- DECORACIÓN DE ELEMENTOS (EXCLUYENDO PORTADAS) --- */
        .content:not(.portada):not(.contraportada) h1, 
        .content:not(.portada):not(.contraportada) h2,
        .content:not(.portada):not(.contraportada) h3 { position: relative; margin-top: 1.5em; padding-bottom: 5px; border-bottom: 1px solid var(--accent); }

        /* Etiquetas técnicas */
        .content:not(.portada):not(.contraportada) h1::before { content: " [H1_ROOT_ACCESS] "; position: absolute; top: -15px; left: 0; background: var(--accent); color: var(--paper-bg); font-size: 7pt; padding: 1px 4px; }
        .content:not(.portada):not(.contraportada) h2::before { content: " [H2_SUB_PATH] "; position: absolute; top: -15px; left: 0; background: var(--accent); color: var(--paper-bg); font-size: 7pt; padding: 1px 4px; }

        /* Citas (Cites/Blockquotes) */
        .content:not(.portada):not(.contraportada) blockquote {
            position: relative;
            margin: 30px 0; padding: 20px;
            background: rgba(0, 229, 255, 0.05);
            border: 1px solid var(--accent);
            font-style: italic;
        }
        .content:not(.portada):not(.contraportada) blockquote::after {
            content: " [REF_SOURCE_DATA] ";
            position: absolute; top: -10px; right: 10px;
            background: var(--accent); color: var(--paper-bg);
            font-size: 7pt; font-family: monospace; padding: 1px 4px;
        }

        /* Listas limpias */
        .content ul { list-style: none; padding-left: 1.5rem; }
        .content ul li { position: relative; margin-bottom: 8px; }
        .content ul li::before { content: "»"; position: absolute; left: -1.2rem; color: var(--accent); font-weight: bold; }

/* --- ESTILO TÉCNICO PARA TABLAS (SIBYL DATA GRID) --- */
.content table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 9pt;
    border: 1px solid var(--accent);
}

.content table thead {
    background: var(--accent);
    color: var(--paper-bg);
}

.content table th {
    padding: 10px;
    text-align: left;
    text-transform: uppercase;
    letter-spacing: 1px;
    border: 1px solid var(--accent);
}

.content table td {
    padding: 8px 10px;
    border: 1px solid rgba(0, 229, 255, 0.2); /* Borde sutil */
}

/* Efecto Zebra técnico */
.content table tr:nth-child(even) {
    background: rgba(0, 229, 255, 0.03);
}

/* Etiqueta automática para tablas */
.content:not(.portada):not(.contraportada) table::before {
    content: " [DATA_GRID_ARRAY] ";
    display: block;
    background: var(--accent);
    color: var(--paper-bg);
    width: fit-content;
    font-size: 7pt;
    padding: 1px 4px;
    margin-bottom: 0;
}

#live-stats { 
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
    font-size: 10px;
    padding-top: 8px;
    letter-spacing: 1px;
    border-left: 2px solid var(--accent);
    padding-left: 10px;
}


        /* --- PORTADA Y CONTRAPORTADA --- */
        .portada { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; border: 10px double var(--accent) !important; }
        .portada h1::before { display: none; } /* Quitar etiqueta en portada */

        .contraportada { 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            background: var(--accent) !important; color: var(--paper-bg) !important; 
        }
        .contraportada * { color: var(--paper-bg) !important; border-color: var(--paper-bg) !important; }
        .contraportada h1::before { display: none; }

        /* Temas y Formatos */
        .format-ig { --width-page: 500px; --height-page: 500px; }
        .format-li { --width-page: 500px; --height-page: 625px; }
        .format-a4 { --width-page: 210mm; --height-page: 297mm; }

        .theme-default { --accent: #00e5ff; }
        .theme-notice { --accent: #ff3e3e; }
        .theme-educational { --accent: #00ff88; }
        .theme-academic { --accent: #d4af37; }
        .mode-light { --paper-bg: #ffffff; --paper-text: #1a1a1a; }
        .mode-dark { --paper-bg: #0a0e14; --paper-text: #d1d5db; }

        .hidden { display: none !important; }

        @media print {
            body * { visibility: hidden; }
            #preview-viewport, #preview-viewport *, .page, .page * { visibility: visible; }
            #preview-viewport { position: absolute; top: 0; left: 0; height: auto; overflow: visible; padding: 0; }
            .page { margin: 0; border: none; page-break-after: always; }
        }
    </style>
</head>
<body class="theme-default mode-dark">

<button id="btn-exit-foco" onclick="toggleFoco()">[ RESTORE_EDITOR ]</button>

<div id="metadata-bar">
    <input type="text" id="meta-file" placeholder="DOCUMENT_ID" oninput="render()">
    <input type="text" id="meta-author" placeholder="AUTHOR_ID" oninput="render()">
    <input type="text" id="meta-location" placeholder="GEOS_ZONE" oninput="render()">
    <div style="font-size: 9px; padding-top: 5px;" id="live-stats">STATS: 0x0</div>
</div>

<section id="editor-container">
    <textarea id="markdown-input" placeholder="Escribe aquí..." oninput="render()"></textarea>
    <div class="toolbar">
        <select id="format-select" onchange="updateLayout()">
            <option value="format-a4">FORMAT: A4_STATIONERY</option>
            <option value="format-ig">FORMAT: INSTAGRAM_SQR</option>
            <option value="format-li">FORMAT: LINKEDIN_PDS</option>
        </select>
        <select id="theme-select" onchange="updateLayout()">
            <option value="theme-default">COLOR: SIBYL_BLUE</option>
            <option value="theme-notice">COLOR: ALERT_RED</option>
            <option value="theme-educational">COLOR: GROWTH_GREEN</option>
            <option value="theme-academic">COLOR: GOLD_ARCHIVE</option>
        </select>
        <label><input type="checkbox" id="mode-toggle" onchange="updateLayout()"> LIGHT_MODE</label>
        <button onclick="toggleFoco()">[ FOCUS ]</button>
        <button onclick="window.print()">[ EXPORT_PDF ]</button>
    </div>
</section>

<section id="preview-viewport">
    <div id="render-target" class="format-a4"></div>
</section>

<script>
    function render() {
    const input = document.getElementById('markdown-input').value;
    const target = document.getElementById('render-target');
    const author = document.getElementById('meta-author').value || "SYS_AUTH";
    const file = document.getElementById('meta-file').value || "UNNAMED_LOG";
    const loc = document.getElementById('meta-location').value || "NET_NODE";
    const now = new Date();
    const fullDate = now.toLocaleDateString() + " " + now.toLocaleTimeString();

    // --- CÁLCULO DE ESTADÍSTICAS ---
    const pagesArray = input.split('<--->');
    const totalPages = pagesArray.length;
    // Contar palabras totales
    const totalWords = input.trim() ? input.trim().split(/\s+/).length : 0;
    
    // Actualizar el pequeño div del editor (Visualización en barra)
    document.getElementById('live-stats').innerText = `METRICS: ${totalPages} • ${totalWords}`;

    target.innerHTML = '';

    pagesArray.forEach((content, i) => {
        const page = document.createElement('div');
        page.className = 'page';
        
        let isPortada = content.includes('<portada>');
        let isContra = content.includes('<contraportada>');

        if(isPortada) page.classList.add('portada');
        if(isContra) page.classList.add('contraportada');

        const cleanContent = content.replace(/<portada>|<\/portada>|<contraportada>|<\/contraportada>/g, '');

        page.innerHTML = `
            <div class="page-header">
                <span>FILE: ${file}</span>
                <span>${fullDate}</span>
            </div>
            <div class="content ${isPortada?'portada':''} ${isContra?'contraportada':''}">
                ${marked.parse(cleanContent)}
            </div>
            <div class="page-footer">
                <span>AUTH: ${author} // ${loc}</span>
                <span style="font-weight: bold; letter-spacing: 2px;">
                    ${i + 1} • ${totalWords}
                </span>
            </div>
        `;
        target.appendChild(page);
    });
    localStorage.setItem('sibyl_ver_01_2', input);
}


    function updateLayout() {
        const format = document.getElementById('format-select').value;
        const theme = document.getElementById('theme-select').value;
        const light = document.getElementById('mode-toggle').checked;
        document.body.className = `${theme} ${light ? 'mode-light' : 'mode-dark'}`;
        document.getElementById('render-target').className = format;
        render();
    }

    function toggleFoco() {
        const editor = document.getElementById('editor-container');
        const meta = document.getElementById('metadata-bar');
        const exitBtn = document.getElementById('btn-exit-foco');
        const preview = document.getElementById('preview-viewport');
        const isHidden = editor.classList.toggle('hidden');
        meta.classList.toggle('hidden');
        exitBtn.style.display = isHidden ? 'block' : 'none';
        preview.style.height = isHidden ? '100vh' : 'calc(60vh - 45px)';
    }

    window.onload = () => {
        const saved = localStorage.getItem('sibyl_ver_01_2');
        if(saved) { document.getElementById('markdown-input').value = saved; render(); }
    };
</script>
</body>
</html>
