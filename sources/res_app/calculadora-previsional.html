<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora Previsional v3 - Estudio Jurídico</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; color: #1a1a1a; padding: 20px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; margin-bottom: 25px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        label { font-weight: 600; display: block; margin-bottom: 8px; color: #34495e; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 8px; box-sizing: border-box; font-size: 15px; }
        input:focus, textarea:focus { border-color: #3498db; outline: none; }
        button { background: #3498db; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; transition: 0.3s; margin-top: 10px; }
        button:hover { background: #2980b9; }
        .results { margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .card { background: #ffffff; padding: 20px; border-radius: 10px; border: 1px solid #dfe6e9; }
        .full-width { grid-column: span 3; background: #2c3e50; color: white; text-align: center; }
        .highlight { font-size: 28px; font-weight: bold; display: block; color: #3498db; }
        .full-width .highlight { color: #5dade2; }
        .status-ok { border-top: 5px solid #27ae60; }
        .status-info { border-top: 5px solid #3498db; }
    </style>
</head>
<body>

<div class="container">
    <h2>Calculadora de Aportes ANSES - Ver_03</h2>
    
    <div class="grid-inputs">
        <div>
            <label>Fecha de Nacimiento</label>
            <input type="text" id="fechaNac" value="09/09/1970">
        </div>
        <div>
            <label>Cantidad de Hijos</label>
            <input type="number" id="hijos" value="2">
        </div>
    </div>

    <label>Sábana de Aportes</label>
    <textarea id="sabanaData" rows="10" placeholder="Pegue aquí los datos..."></textarea>

    <button onclick="calcular()">GENERAR CÁLCULO FINAL</button>

    <div class="results" id="output" style="display:none;">
        <div class="card full-width">
            <span>TOTAL CAPITALIZADO (Aportes + Hijos)</span>
            <span class="highlight" id="granTotal">0 meses</span>
            <span id="txtAños">0 años</span>
        </div>
        
        <div class="card status-ok">
            <strong>Ley Anterior (hasta 09/93)</strong>
            <p>Efectivos: <span id="lAntEf" style="font-weight:bold">0</span> meses</p>
            <p>Huecos compra: <span id="lAntComp">0</span> meses</p>
        </div>

        <div class="card status-ok">
            <strong>Ley Nueva (10/93 a 03/12)</strong>
            <p>Efectivos: <span id="lNuEf" style="font-weight:bold">0</span> meses</p>
            <p>Huecos compra: <span id="lNuComp">0</span> meses</p>
        </div>

        <div class="card status-info">
            <strong>Extras y Post-Moratoria</strong>
            <p>Post 03/2012: <span id="lPost">0</span> meses</p>
            <p>Por Hijos: <span id="lHijos">0</span> meses</p>
            <p>Acumulación días: <span id="lRes">0</span> meses</p>
        </div>
    </div>
</div>

<script>
function calcular() {
    const hijos = parseInt(document.getElementById('hijos').value) || 0;
    const dataRaw = document.getElementById('sabanaData').value;
    
    // Fechas de corte
    const inicio18 = new Date(1988, 8, 9); // 09/88
    const corteLant = new Date(1993, 8, 30);
    const inicioLnu = new Date(1993, 9, 1);
    const corteLnu = new Date(2012, 2, 31);

    let mAnt = 0, mNu = 0, mPost = 0, dRes = 0;

    const lineas = dataRaw.split('\n');

    lineas.forEach(linea => {
        const fechas = linea.match(/(\d{2})\/(\d{4})/g);
        if (!fechas) return;

        // Si la línea tiene dos fechas (ej: 01/1992 12/1992), calculamos el rango
        if (fechas.length >= 2) {
            const [m1, a1] = fechas[0].split('/');
            const [m2, a2] = fechas[1].split('/');
            const f1 = new Date(a1, m1-1, 1);
            const f2 = new Date(a2, m2-1, 1);
            
            let temp = new Date(f1);
            while(temp <= f2) {
                if (temp >= inicio18 && temp <= corteLant) mAnt++;
                else if (temp >= inicioLnu && temp <= corteLnu) mNu++;
                else if (temp > corteLnu) mPost++;
                temp.setMonth(temp.getMonth() + 1);
            }
        } 
        // Si tiene una sola fecha, es el formato de la sábana moderna
        else {
            const [pMes, pAño] = fechas[0].split('/');
            const fechaP = new Date(pAño, pMes - 1, 1);
            const numeros = linea.match(/\d+/g) || [];
            
            // Buscar días y horas después de la fecha
            const idxFecha = linea.indexOf(fechas[0]);
            const valores = linea.substring(idxFecha + 7).trim().split(/\s+/);
            const dias = parseInt(valores[0]) || 0;
            const horas = parseInt(valores[1]) || 0;

            if (horas > 0) return; // Regla de exclusión

            if ([0, 30, 31, 27, 28].includes(dias)) {
                if (fechaP >= inicio18 && fechaP <= corteLant) mAnt++;
                else if (fechaP >= inicioLnu && fechaP <= corteLnu) mNu++;
                else if (fechaP > corteLnu) mPost++;
            } else {
                dRes += dias;
            }
        }
    });

    const mRes = Math.floor(dRes / 30);
    const mHijos = hijos * 12;
    const total = mAnt + mNu + mPost + mRes + mHijos;

    document.getElementById('output').style.display = 'grid';
    document.getElementById('granTotal').innerText = total + " meses";
    document.getElementById('txtAños').innerText = (total/12).toFixed(1) + " años";
    document.getElementById('lAntEf').innerText = mAnt;
    document.getElementById('lNuEf').innerText = mNu;
    document.getElementById('lPost').innerText = mPost;
    document.getElementById('lHijos').innerText = mHijos;
    document.getElementById('lRes').innerText = mRes + " (" + dRes + " días sueltos)";
    document.getElementById('lAntComp').innerText = Math.max(0, 61 - mAnt);
    document.getElementById('lNuComp').innerText = Math.max(0, 222 - mNu);
}
</script>
</body>
</html>
