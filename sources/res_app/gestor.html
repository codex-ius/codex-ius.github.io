<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Jurídico v1.0</title>
    <style>
        /* CSS MÍNIMO Y FUNCIONAL */
        body { font-family: sans-serif; margin: 0; background: #f0f2f5; color: #333; }
        header { background: #1a73e8; color: white; padding: 15px; text-align: center; font-weight: bold; }
        .container { padding: 20px; max-width: 600px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .hidden { display: none !important; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0 20px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        label { font-weight: bold; font-size: 14px; color: #1a73e8; }
        .btn { background: #1a73e8; color: white; border: none; padding: 12px; width: 100%; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #34a853; margin-bottom: 15px; }
        .moratoria-box { background: #e8f0fe; padding: 15px; border-radius: 4px; margin-bottom: 10px; border-left: 5px solid #1a73e8; }
    </style>
</head>
<body>

<header> GESTOR DE EXPEDIENTES </header>

<div class="container">
    <div id="login-screen" class="card">
        <h3>Acceso al Sistema</h3>
        <label>PIN de Seguridad</label>
        <input type="password" id="pass-input" placeholder="Ingresa 123 o 456">
        <button class="btn" onclick="ejecutarLogin()">ENTRAR</button>
    </div>

    <div id="main-content" class="hidden">
        <div class="card">
            <h3>Datos del Cliente</h3>
            <label>DNI</label>
            <input type="number" id="dni" class="master-field">
            
            <label>Nombre y Apellido</label>
            <input type="text" id="nombre" class="master-field">
            
            <label>Estado del Trámite</label>
            <select id="estado_tramite">
                <option>Iniciado</option>
                <option>En Cómputos</option>
                <option>Acordado</option>
            </select>
        </div>

        <div class="card">
            <h3>Moratorias</h3>
            <div id="moratorias-wrapper"></div>
            <button class="btn btn-add" onclick="crearGrupoMoratoria()">+ Agregar Plan</button>
        </div>

        <div class="card">
            <label>Notas de Gestión</label>
            <textarea id="notas" rows="4"></textarea>
            <button class="btn" onclick="enviarDatos()">GUARDAR EN DRIVE</button>
        </div>
    </div>
</div>

<script>
    // CAMBIA ESTA URL POR LA TUYA DE GOOGLE (LA QUE TERMINA EN /exec)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwLdk4j2Pc7Ng88TunAhNTveET1SDgDIcm-JVgXxNxLkMWReNYDB3JLf5-4o2lQE0T-/exec";
    
    let USER_ROLE = "";

    // FUNCIÓN DE LOGIN
    async function ejecutarLogin() {
        const pin = document.getElementById('pass-input').value;
        
        if (pin === "123" || pin === "456") {
            USER_ROLE = (pin === "123") ? "MAESTRO" : "RESTRINGIDO";
            
            // Intentar avisar al script (opcional, para registro)
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ action: "login", pin: pin })
            });

            // Cambiar de pantalla
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            
            if(USER_ROLE === "RESTRINGIDO") {
                document.querySelectorAll('.master-field').forEach(el => el.disabled = true);
            }
        } else {
            alert("PIN Incorrecto");
        }
    }

    // AGREGAR MORATORIA
    function crearGrupoMoratoria() {
        const wrapper = document.getElementById('moratorias-wrapper');
        const box = document.createElement('div');
        box.className = 'moratoria-box';
        box.innerHTML = `
            <label>Ley</label><input type="text" class="m-ley">
            <label>Cuotas Pagas</label><input type="number" class="m-pagas">
            <button onclick="this.parentElement.remove()" style="color:red; background:none; border:none; cursor:pointer;">[Eliminar]</button>
        `;
        wrapper.appendChild(box);
    }

    // ENVIAR DATOS AL SHEET
    async function enviarDatos() {
        const moratorias = [];
        document.querySelectorAll('.moratoria-box').forEach(box => {
            moratorias.push({
                ley: box.querySelector('.m-ley').value,
                pagas: box.querySelector('.m-pagas').value
            });
        });

        const payload = {
            action: "guardarExpediente",
            dni: document.getElementById('dni').value,
            nombre: document.getElementById('nombre').value,
            estado: document.getElementById('estado_tramite').value,
            notas: document.getElementById('notas').value,
            moratorias: JSON.stringify(moratorias),
            usuario: USER_ROLE
        };

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(payload)
            });
            alert("Datos enviados con éxito a la nube.");
        } catch (e) {
            alert("Error al enviar. Revisa la consola.");
        }
    }
</script>

</body>
</html>
